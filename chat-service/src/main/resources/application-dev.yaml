# ========================================
# Chat Service 개발 환경 설정 파일
# ========================================
#
# 개발 환경에서 사용되는 설정입니다.
# application.yml의 기본 설정을 오버라이드 합니다.
#
# 환경 변수 사용:
# - ${환경변수명}: 기본값 없이 환경 변수 사용
# - ${환경변수명:기본값}: 환경 변수가 없을 때 기본값 사용

server:
  port: ${CHAT_SERVICE_PORT:8080}

spring:
  datasource:
    url: jdbc:mysql://${DB_HOST}:${DB_PORT:3306}/${CHAT_DB_NAME:bebee_chat}?serverTimezone=UTC&allowPublicKeyRetrieval=true&useSSL=false&autoReconnect=true&useUnicode=true&characterEncoding=UTF-8
    username: ${DB_USERNAME:}
    password: ${DB_PASSWORD:}
    driver-class-name: com.mysql.cj.jdbc.Driver
    hikari:
      connection-test-query: SELECT 1
      validation-timeout: 5000
      maximum-pool-size: 10
      minimum-idle: 5
      idle-timeout: 30000
      max-lifetime: 1800000

  # JPA (Java Persistence API) 설정
  jpa:
    # Hibernate 설정
    hibernate:
      # 데이터베이스 스키마 자동 생성 설정 (환경 변수에서 가져오거나 기본값 update 사용)
      # update: 엔티티 변경사항을 자동으로 데이터베이스에 반영
      # create: 애플리케이션 시작 시 테이블을 새로 생성 (기존 데이터 삭제)
      # validate: 엔티티와 데이터베이스 스키마 일치 여부만 검증
      # none: 자동 스키마 생성 비활성화
      ddl-auto: ${HIBERNATE_DDL_AUTO:none}

      # SQL 쿼리 로그 출력 설정 (환경 변수에서 가져오거나 기본값 true 사용)
      show-sql: ${SHOW_SQL:false}

      # Hibernate 추가 속성 설정
      properties:
        hibernate:
          # SQL 쿼리 포맷팅 설정 (환경 변수에서 가져오거나 기본값 true 사용)
          # 가독성을 위해 들여쓰기 적용
          format_sql: ${FORMAT_SQL:false}

  data:
    # Redis 설정
    redis:
      # Redis Host
      host: ${REDIS_HOST:}
      # Redis Port
      port: ${REDIS_PORT:6379}
      username: ${REDIS_USERNAME:}
      password: ${REDIS_PASSWORD:}

    # Mongodb 설정
    mongodb:
      uri: ${MONGODB_URI:mongodb://${MONGODB_USERNAME:bebee}:${MONGODB_PASSWORD:bebee1234}@${MONGODB_HOST:mongo-db}:27017/bebee?authSource=admin}
      auto-index-creation: ${AUTO_INDEX_CREATION:false}

  # Flyway 설정ㅇ
  flyway:
    # Flyway 활성화
    enabled: true
    # 마이그레이션 파일 위치
    locations:
      - classpath:db/migration
      - classpath:db/seed
    # 파일 인코딩
    encoding: UTF-8
    # 기존 DB에 적용 시 baseline 생성
    baseline-on-migrate: true
    # Baseline 버전
    baseline-version: 0
    # 마이그레이션 전 검증
    validate-on-migrate: true
    # 순서 엄격히 지킴
    out-of-order: false
    # 플레이스홀더 비활성화
    placeholder-replacement: false
    # clean 명령 비활성화 (안전)
    # clean-disabled: true

springdoc:
  api-docs:
    path: /api-docs
    enabled: true
  swagger-ui:
    path: /swagger-ui.html
    enabled: true
    tags-sorter: alpha
    operations-sorter: alpha
  default-consumes-media-type: application/json
  default-produces-media-type: application/json

  api:
    host: "${SPRINGDOC_API_HOST:http://localhost:8081}"
    desc: "${SPRINGDOC_API_DESC:로컬 서버}"

tsid:
  node:
    id: ${NODE_ID:0}

# WebSocket Handshake를 허용할 클라이언트 출처 패턴 목록
websocket:
  stomp:
    allowed-origin-patterns: "${WEBSOCKET_ALLOWED_ORIGINS:http://localhost:[*],https://localhost:[*]}"

# 로깅 설정
logging:
  level:
    # 루트 로그 레벨 설정 (환경 변수에서 가져오거나 기본값 info 사용)
    root: ${LOGGING_LEVEL_ROOT:INFO}

    # Hibernate SQL 쿼리 로그 레벨 (debug: 상세한 쿼리 정보 출력)
    org.hibernate.SQL: DEBUG

    # Hibernate 파라미터 바인딩 로그 레벨 (trace: 모든 파라미터 값 출력)
    org.hibernate.type: TRACE

    # Spring Data MongoDB Template 로그 레벨 (DEBUG: MongoDB 쿼리 정보 출력)
    org.springframework.data.mongodb.core.MongoTemplate: DEBUG

    # 애플리케이션 서비스 패키지 로그 레벨
    com.lgcns.bebee.chat: ${LOGGING_LEVEL_SERVICE:INFO}